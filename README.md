Edya - Нейросеть, [04.12.2024 16:09]

# Структура приложения NestJS

Данный документ описывает основные компоненты и взаимосвязи в типичном приложении NestJS. Понимание этих элементов критично для создания и поддержания работоспособных приложений.

## Основные концепции

**Модули**: Основа организации в NestJS. Модули группируют связанные классы (контроллеры, сервисы, репозитории и т.д.). Модули позволяют использовать инъекцию зависимостей и разделение ответственности.

**Контроллеры**: Представляют собой входные точки приложения для входящих запросов (HTTP, WebSocket и т.д.). Они обрабатывают маршрутизацию и взаимодействуют с сервисами для обработки запросов. Думайте о них как об API-эндпоинтах.

**Сервисы**: Содержат бизнес-логику вашего приложения. Сервисы отвечают за взаимодействие с источниками данных (базами данных, API) и выполнение вычислений или преобразований. Они часто действуют как посредники между контроллерами и доступом к данным.

**Репозитории**: Управляют взаимодействием с источниками данных (например, базами данных). Они абстрагируют специфику реализации базы данных. Часто используют @InjectModel из NestJS для взаимодействия с Mongoose, TypeORM или другими ORM-библиотеками.

**Пайпы**: Используются для валидации и преобразования входных данных перед достижением контроллера или сервиса. Обеспечивают очистку и валидацию данных.

**Гварды (Guards)**: Авторизуют запросы на основе ролей пользователей, прав или других критериев. Часто применяются для ограничения доступа.

**Интерцепторы (Interceptors)**: Модифицируют запросы и ответы до и после их обработки контроллером или сервисом. Полезны для логирования, кэширования или ограничения скорости.

## Пример структуры

```
мое-приложение-nestjs/
├── src/
│   ├── app.module.ts              // Главный модуль приложения
│   ├── app.controller.ts          // Главный контроллер приложения
│   ├── app.service.ts             // Главный сервис приложения
│   ├── users/                      // Модули/контроллеры/сервисы, связанные с пользователями
│   │   ├── users.module.ts
│   │   ├── users.controller.ts
│   │   └── users.service.ts
│   │       └── users.repository.ts  // Слой доступа к данным
│   ├── products/                   // Модули/контроллеры/сервисы, связанные с продуктами
│   └── ...
│   ├── auth/                      // Компоненты аутентификации
│   └── common/                     // Общие модули (например, пайпы, гварды)
│       ├── ...
├── test/
│   ├── app.e2e-spec.ts            // Тесты взаимодействия с приложением
│   ├── app.controller.spec.ts      // Юнит-тесты
│   ├── users/                     // Юнит-тесты для модуля users
│   └── ...
└── package.json                   // Зависимости проекта
└── tsconfig.json                  // Конфигурация TypeScript
```

## Основные принципы проектирования

**Инъекция зависимостей**: NestJS сильно опирается на инъекцию зависимостей. Это позволяет создать слабосвязанные компоненты, упрощает тестирование и повышает поддерживаемость.
**Разделение ответственности**: Организуйте свой код в модули, контроллеры, сервисы и репозитории, чтобы сосредоточить логику.
**Пайпы и валидаторы** :Используйте пайпы для принудительной валидации входных данных и преобразования данных в ожидаемые форматы.
**Гварды и интерцепторы** :Реализуйте пользовательскую логику авторизации и модификации запросов/ответов.
**Тестирование**: NestJS поддерживает как юнит-тестирование, так и тестирование взаимодействия с приложением (end-to-end).

## Пример модуля

// src/users/users.module.ts
import { Module } from '@nestjs/common';
import { UsersController } from './users.controller';
import { UsersService } from './users.service';
import { UsersRepository } from './users.repository'; // или другой доступ к данным

@Module({
controllers: [UsersController],
providers: [UsersService, UsersRepository],
imports: [ // Любые другие модули, от которых зависит этот модуль
],
})
export class UsersModule {}
